modules = ["nodejs-22"]

[workflows]
runButton = "Project"

# ===============================================================================
# MAIN PROJECT – Runs Mobile + Web in parallel
# ===============================================================================
[[workflows.workflow]]
name = "Project"
mode = "parallel"
author = "agent"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "SkateHubba Mobile"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "SkateHubba Web"

# ===============================================================================
# MOBILE – Expo Dev Server
# ===============================================================================
[[workflows.workflow]]
name = "SkateHubba Mobile"
author = "agent"
[workflows.workflow.metadata]
outputType = "webview"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "pnpm --filter mobile dev --host"
waitForPort = 8081

# ===============================================================================
# WEB – Next.js Dev Server
# ===============================================================================
[[workflows.workflow]]
name = "SkateHubba Web"
author = "agent"
[workflows.workflow.metadata]
outputType = "webview"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "pnpm --filter web dev"
waitForPort = 3000

# ===============================================================================
# PORTS – Expose to Replit preview
# ===============================================================================
[[ports]]
localPort = 8081
externalPort = 8081
description = "Expo Mobile"

[[ports]]
localPort = 3000
externalPort = 3000
description = "Next.js Web"

# ===============================================================================
# DEPLOYMENT – EAS + Vercel (Production)
# ===============================================================================
[deployment]
deploymentTarget = "autoscale"
run = ["echo", "Deploy via EAS + Vercel"]
build = [
  "pnpm install --frozen-lockfile",
  "pnpm run build --filter web",
  "echo 'Web built'",
  "echo 'Mobile built via EAS'"
]

# ===============================================================================
# NIX – Node 22 + pnpm
# ===============================================================================
[nix]
channel = "stable-25_05"

[agent]
expertMode = true
