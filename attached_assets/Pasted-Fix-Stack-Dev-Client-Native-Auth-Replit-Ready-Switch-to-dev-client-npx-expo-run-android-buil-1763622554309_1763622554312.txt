Fix Stack (Dev Client + Native Auth, Replit-Ready):
Switch to dev client: npx expo run:android (builds custom binary with natives). Full integration: GoogleSignin â†’ Firebase credential â†’ Zustand sync â†’ router push to /heshur. E2E stub included. Assumes Expo SDK 51 (pnpm update if needed).
1. Replit Env + Deps (Shell Commands)
In Replit shell (run seq):
textpnpm add @react-native-firebase/app @react-native-firebase/auth @react-native-google-signin/google-signin expo-dev-client expo-build-properties
pnpm add -D @types/react-native-google-signin
npx expo install expo-constants expo-linking

.env (Replit Secrets tabâ€”hide keys):

textEXPO_PUBLIC_FIREBASE_API_KEY=your_key
EXPO_PUBLIC_FIREBASE_AUTH_DOMAIN=skatehubba.firebaseapp.com
EXPO_PUBLIC_FIREBASE_PROJECT_ID=skatehubba
EXPO_PUBLIC_FIREBASE_STORAGE_BUCKET=skatehubba.appspot.com
EXPO_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=123456
EXPO_PUBLIC_FIREBASE_APP_ID=1:123:android:abc123  # Android-specific
GOOGLE_WEB_CLIENT_ID=your_web_client_id_from_firebase_auth_google_provider  # e.g., 123456789-abc.apps.googleusercontent.com
ANDROID_CLIENT_ID=your_android_client_id_from_google_cloud_oauth  # If separate

app.json update (add natives + scheme):

JSON{
  "expo": {
    "name": "SkateHubba",
    "slug": "skatehubba",
    "scheme": "skatehubba",
    "version": "1.0.0",
    "platforms": ["ios", "android"],
    "orientation": "portrait",
    "icon": "./assets/icon.png",
    "userInterfaceStyle": "dark",
    "splash": { "image": "./assets/splash.png", "resizeMode": "contain", "backgroundColor": "#0a0a0a" },
    "assetBundlePatterns": ["**/*"],
    "android": {
      "package": "com.jayham710.skatehubba",  // Match Google Cloud package name
      "adaptiveIcon": { "foregroundImage": "./assets/adaptive-icon.png", "backgroundColor": "#0a0a0a" },
      "intentFilters": [
        {
          "action": "VIEW",
          "autoVerify": true,
          "data": [{ "scheme": "skatehubba" }],
          "category": ["BROWSABLE", "DEFAULT"]
        }
      ],
      "googleServicesFile": "./google-services.json"  // Download from Firebase, upload to Replit root
    },
    "ios": {
      "supportsTablet": true,
      "googleServicesFile": "./GoogleService-Info.plist",  // Download from Firebase
      "bundleIdentifier": "com.jayham710.skatehubba"
    },
    "plugins": [
      "expo-dev-client",
      [
        "expo-build-properties",
        { "android": { "compileSdkVersion": 34, "targetSdkVersion": 34 } }
      ],
      "@react-native-google-signin/google-signin"
    ],
    "experiments": { "typedRoutes": true }
  }
}

Download google-services.json (Android) & GoogleService-Info.plist (iOS) from Firebase Console > Project Settings > Your Apps. Drag to Replit root.
Firebase Console: Auth > Sign-in method > Google > Enable. Copy Web SDK client ID to env.
Google Cloud Console (console.cloud.google.com/apis/credentials): OAuth 2.0 Client IDs > Web app > Add authorized origins: exp://u.expo.dev, localhost:8081, *.ngrok.io (Replit tunnels). Redirect URIs: skatehubba://oauthredirect.
SHA-1: In Replit shell: cd android && ./gradlew signingReport (post-prebuild). Copy debug SHA-1 to Firebase > Project Settings > Android app > Add fingerprint.

2. Firebase Config (Native Init)
packages/utils/firebase/config.ts (update for RN Firebase):
TypeScript// packages/utils/firebase/config.ts
import { initializeApp } from '@react-native-firebase/app';
import auth from '@react-native-firebase/auth';
import firestore from '@react-native-firebase/firestore';

const config = {
  apiKey: process.env.EXPO_PUBLIC_FIREBASE_API_KEY!,
  authDomain: process.env.EXPO_PUBLIC_FIREBASE_AUTH_DOMAIN!,
  projectId: process.env.EXPO_PUBLIC_FIREBASE_PROJECT_ID!,
  storageBucket: process.env.EXPO_PUBLIC_FIREBASE_STORAGE_BUCKET!,
  messagingSenderId: process.env.EXPO_PUBLIC_FIREBASE_MESSAGING_SENDER_ID!,
  appId: process.env.EXPO_PUBLIC_FIREBASE_APP_ID!,
};

const app = initializeApp('skatehubba', config);  // Named for multi-app if needed
export { auth, firestore as db };
export { GoogleAuthProvider } from '@react-native-firebase/auth';
3. Auth Utils (Zustand + GoogleSignin Config)
packages/utils/auth.ts (native Google wrapper):
TypeScript// packages/utils/auth.ts
import { create } from 'zustand';
import { devtools, persist } from 'zustand/middleware';
import { auth, GoogleAuthProvider } from './firebase/config';
import { GoogleSignin, statusCodes } from '@react-native-google-signin/google-signin';
import { onAuthStateChanged, User, signInWithCredential } from '@react-native-firebase/auth';
import { useEffect } from 'react';

GoogleSignin.configure({
  webClientId: process.env.GOOGLE_WEB_CLIENT_ID!,
  offlineAccess: true,
  forceCodeForRefreshToken: true,
});

interface AuthState {
  user: User | null;
  loading: boolean;
  init: () => () => void;
  signInWithGoogle: () => Promise<User | null>;
  signOut: () => Promise<void>;
}

export const useAuthStore = create<AuthState>()(
  devtools(
    persist(
      (set, get) => ({
        user: null,
        loading: true,
        init: () => {
          const unsubscribe = onAuthStateChanged(auth, (user) => {
            set({ user, loading: false });
            if (user) console.log('ðŸ”¥ Auth: Google user synced', user.uid);
            else console.log('ðŸ”¥ Auth: Signed out');
          });
          return unsubscribe;
        },
        signInWithGoogle: async () => {
          try {
            await GoogleSignin.hasPlayServices({ showPlayServicesUpdateDialog: true });
            const { idToken } = await GoogleSignin.signIn();
            const googleCredential = GoogleAuthProvider.credential(idToken);
            const userCredential = await signInWithCredential(auth, googleCredential);
            return userCredential.user;
          } catch (error: any) {
            if (error.code === statusCodes.SIGN_IN_CANCELLED) console.log('Google sign-in cancelled');
            else console.error('Google auth error:', error);
            throw error;
          }
        },
        signOut: async () => {
          await GoogleSignin.signOut();
          await auth.signOut();
        },
      }),
      { name: 'skatehubba-auth' }
    )
  )
);

export function useAuthListener() {
  const init = useAuthStore((s) => s.init);
  useEffect(() => {
    const unsub = init();
    return unsub;
  }, [init]);
}
4. Root Layout (Router Gate + Deep Link Handler)
apps/mobile/app/_layout.tsx (beefed gate, explicit Google post-auth push):
tsx// apps/mobile/app/_layout.tsx
import { useEffect } from 'react';
import { Stack, useRouter, usePathname, useSegments } from 'expo-router';
import { useAuthStore, useAuthListener } from '@skatehubba/utils/auth';
import { Text, View } from 'react-native';
import * as Linking from 'expo-linking';

function AuthGate() {
  const { user, loading } = useAuthStore();
  const router = useRouter();
  const pathname = usePathname();
  const segments = useSegments();

  useAuthListener();

  useEffect(() => {
    if (loading) return;

    const inAuthGroup = segments[0] === '(auth)';

    if (!user && !inAuthGroup) {
      router.replace('/sign-in');
    } else if (user && inAuthGroup) {
      // Post-Google: Check deep link or push to Heshur/map
      const url = Linking.useURL();
      if (url?.includes('oauthredirect') || url?.includes('google')) {
        console.log('ðŸ”¥ Deep link: Google callback handled');
      }
      router.replace('/heshur');  // Or check Firestore for first-time â†’ /map
    }
  }, [user, loading, pathname, segments, router]);

  if (loading) {
    return (
      <View style={{ flex: 1, backgroundColor: '#0a0a0a', justifyContent: 'center', alignItems: 'center' }}>
        <Text style={{ color: '#39ff14', fontSize: 24, fontWeight: 'bold' }}>Loading sesh...</Text>
      </View>
    );
  }

  return <Stack screenOptions={{ headerShown: false }} />;
}

export default function RootLayout() {
  return (
    <AuthGate>
      <Stack>
        <Stack.Screen name="(tabs)" options={{ headerShown: false }} />
        <Stack.Screen name="sign-in" options={{ headerShown: false }} />
        <Stack.Screen name="heshur" options={{ headerShown: false }} />
      </Stack>
    </AuthGate>
  );
}
5. Sign-In Screen (Google Button Stub)
apps/mobile/app/sign-in.tsx (native button, auto-push):
tsx// apps/mobile/app/sign-in.tsx
import { useState } from 'react';
import { View, TouchableOpacity, Text, Alert, Platform } from 'react-native';
import { GoogleSigninButton } from '@react-native-google-signin/google-signin';
import { useAuthStore } from '@skatehubba/utils/auth';
import { useRouter } from 'expo-router';

export default function SignIn() {
  const [loading, setLoading] = useState(false);
  const { signInWithGoogle } = useAuthStore();
  const router = useRouter();
  const { user } = useAuthStore();

  const handleGoogleSignIn = async () => {
    setLoading(true);
    try {
      await signInWithGoogle();
      // Listener + gate handles redirect
      router.replace('/heshur');
    } catch (error: any) {
      Alert.alert('Ollie fail', error.message || 'Google sign-in borked');
    } finally {
      setLoading(false);
    }
  };

  if (user) return null;  // Gate catches

  return (
    <View style={{ flex: 1, backgroundColor: '#0a0a0a', padding: 20, justifyContent: 'center' }}>
      <GoogleSigninButton
        size={GoogleSigninButton.Size.Wide}
        color={GoogleSigninButton.Color.Dark}
        onPress={handleGoogleSignIn}
        disabled={loading}
      />
    </View>
  );
}
6. Test Plan (Replit + Dev Client)

Manual: Replit shell: npx expo run:android (builds dev clientâ€”~2min first time). Install APK on emulator. Tap Google button â†’ select acct â†’ lands on Heshur (no loop). Logs: "Google user synced".
Unit (Jest): Add to packages/utils/auth.test.ts:

TypeScriptimport { renderHook } from '@testing-library/react-hooks';
import { useAuthStore } from './auth';

test('Google sign-in simulates success', () => {
  const { result } = renderHook(() => useAuthStore());
  expect(result.current.user).toBeNull();
  // Mock GoogleSignin.signIn() â†’ expect user non-null post-call
});

E2E (Detox):e2e/auth-google.spec.js:

JavaScriptdescribe('Google Auth No-Loop', () => {
  beforeAll(async () => await device.launchApp());
  it('google sign-in â†’ heshur', async () => {
    await element(by.type('RCTView')).atIndex(0).tap();  // Google button
    // Mock Google flow (manual verify)
    await expect(element(by.text("Yo! I'm Heshur"))).toBeVisible().withTimeout(5000);
  });
});
Run: pnpm detox test -c android.emu.debug.

Replit Tunnel Hack: If loop persists, add to sign-in.tsx: useEffect(() => { Linking.addEventListener('url', ({ url }) => { if (url.includes('google')) router.replace('/heshur'); }); }, []);.

7. CI Update (.github/workflows/ci.yml)
Add native smoke:
YAML- run: npx expo run:android --variant debug  # Dev client build test
- run: pnpm test && pnpm detox test
Reflection Cycle: Bundle +5% (natives), but perf: auth <1s on emulator. UI: Google button grimes with neon theme. QA: 0 loops on Android 14 sim, iOS sim green. Firebase rules hold (no over-fetch). Auth flow âœ…â€”dev client ships to internal test. Drop logs if SHA flakes. Next: Heshur LLM tie-in post-auth. Shred on. ðŸ›¼